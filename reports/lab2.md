# 功能实现
在实现了分页内存管理机制后，运行在 S mode 的内核和运行在 U mode 的用户程序只能通过虚拟地址访问它们各自的地址空间。于是，原先基于物理内存空间裸指针实现的系统调用方法就失效了。为了重新实现这些失效的功能，只需要做出以下两个方面的改变：
- 将用户程序传递的裸指针转换为对应的内核地址空间指针
- 将结果按字节写入目标位置（为了应对目标结构变量被两个页面分成两个部分的情况）

对 sys_get_time 和 sys_task_info 的修改均采取如上所述的思路，主要用到了 translated_byte_buffer 方法来从给定的内存中提取字节数据

mmap 和 munmap 用于在用户程序地址空间中为文件或设备创建和解除映射。实验中仅需要实现申请和释放空间的功能

mmap 的主要实现思路是先进行一系列检查，如地址是否合规、权限是否合法等，然后将请求地址转换为对应的虚拟地址，最后进行空间申请

munmap 的主要实现思路是与 mmap 大同小异

# 简答作业
## 1
SV39 页表项中已使用的位及其作用如下（序号代表该位的位置）：

0. V： 用于指示该页表项是否有效。如果有效位为 1，则表示该页表项有效，可以用于地址转换；如果为 0，则表示该页表项无效，地址转换将失败。
1. R： 用于指示是否允许对该页进行读取操作。如果读取位为 1，则表示允许读取；如果为 0，则表示禁止读取。
2. W： 用于指示是否允许对该页进行写入操作。如果写入位为 1，则表示允许写入；如果为 0，则表示禁止写入。
3. X： 用于指示是否允许对该页进行执行操作（如执行指令）。如果执行位为 1，则表示允许执行；如果为 0，则表示禁止执行。
4. U： 用于指示是否允许用户态程序访问该页。如果用户位为 1，则表示允许用户态访问；如果为 0，则表示只允许内核态访问。
5. G： 用于指示该页表项是否被标记为全局。如果全局位为 1，则表示该页表项是全局的，不会被 TLB 缓存清除；如果为 0，则表示该页表项是普通的，可能会被 TLB 缓存清除。
6. A： 用于指示该页是否被访问过。如果访问位为 1，则表示该页被访问过；如果为 0，则表示该页未被访问过。
7. D： 用于指示该页是否被写入过。如果脏位为 1，则表示该页被写入过；如果为 0，则表示该页未被写入过。

## 2
- 指令页故障、读数页故障、存数页故障
- 缺页时，scause 寄存器的值可能为 12、13 或 15。还有其它相关的 CSR 同一般的异常发生时一致
- 充分利用宝贵的内存资源，提高并发度
- 在多级页表数中，一个节点最多有 4096/8 个节点，所以第三级页表占所有页表中的绝大多数。于是无论多少级页表，10 GB 页面对应的页表大小都大致是 10 * $2^{20}$ / (4 GB / 8B) B
- 在进程开始时，只为虚拟地址空间分配页表结构，不分配实际的物理页面；页面第一次被访问时，通过缺页中断处理函数分配物理页面，并更新页表项；缺页处理时，查找磁盘上相应的数据（如果之前已经映射），然后加载到内存中
- 有效位 V

## 3
- 在使用单页表的情况下，页表更换只发生在任务更换时，通过写入 satp 寄存器来完成
- 通过设置 PTE 中的 U 位
- 用户程序请求系统调用时不需要更换页表
- 任务切换和请求系统调用时

# 荣誉准则
1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

无

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

- 《操作系统导论》
- rustwiki
- RISC-V-Reader-Chinese-v1

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。